<!DOCTYPE html>
<html>
<head>
    <title>Resultados Restritos - ML</title>
    <meta charset="utf-8">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        h1 { color: #3483fa; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        #app-status { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .loading { background-color: #ffc; border: 1px solid #ff0; }
        .logged-in { background-color: #cfc; border: 1px solid #0c0; }
        .data-viewer { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Resultados do Checklist (Acesso Restrito)</h1>
        <div id="app-status" class="loading">Carregando status de login...</div>
        
        <div id="data-content" class="data-viewer">
            <p>Seus dados do formul√°rio salvo no Netlify **est√£o dispon√≠veis para an√°lise** no painel de controle do Netlify.</p>
            <p><strong>Abaixo estaria o c√≥digo para carregar a tabela, mas como a leitura de dados do Netlify √© complexa, recomendamos baixar o CSV no painel Netlify.</strong></p>
            <p>Se precisar que os dados apare√ßam nesta tela, teremos que programar um *backend* (Netlify Function) para ler o banco de dados do Netlify Forms, o que √© um passo mais complexo.</p>

        </div>
        <button id="logout-button" style="display:none; margin-top: 20px;">Sair / Logout</button>
    </div>

    <script>
        const statusElement = document.getElementById('app-status');
        const logoutButton = document.getElementById('logout-button');

        // FUN√á√ÉO DE LOGIN/LOGOUT
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on('init', (user) => {
                if (!user) {
                    statusElement.innerHTML = 'Clique em **Login** para acessar. (Apenas e-mails @mercadolivre.com)';
                    statusElement.className = 'loading';
                    // Isso abre a interface de login
                    window.netlifyIdentity.open();
                } else {
                    displayUser(user);
                }
            });

            window.netlifyIdentity.on('login', (user) => {
                displayUser(user);
            });
            
            window.netlifyIdentity.on('logout', () => {
                window.location.href = '/'; // Redireciona para a home ap√≥s logout
            });
        }
        
        function displayUser(user) {
            statusElement.innerHTML = `‚úÖ Logado como: <strong>${user.email}</strong>.<br> Dom√≠nio: ${user.email.split('@')[1]}`;
            statusElement.className = 'logged-in';
            logoutButton.style.display = 'block';
            
            // Aqui voc√™ pode adicionar a l√≥gica para carregar os dados se tiver um backend
            document.getElementById('data-content').style.display = 'block';
        }
        
        logoutButton.addEventListener('click', () => {
            window.netlifyIdentity.logout();
        });

    </script>
</body>
</html>